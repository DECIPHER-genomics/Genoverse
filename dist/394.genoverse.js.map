{"version":3,"file":"394.genoverse.js","mappings":"gIAuNA,WAAiBA,UApNF,SAAUC,GACvB,IAAMC,EAASC,KAAKD,OAEpB,SAASE,IACP,IAAMC,EAAeH,EAAO,+BACtBI,EAAeJ,EAAO,wCAAwCK,KAAKF,GAAYG,aAAaL,KAAKM,SACjGC,EAAeP,KAAKQ,UAAYR,KAAKS,WACrCC,EAAI,UAAcZ,EAAWa,cAAgBJ,EAA3B,UAA6CA,EAA7C,MAAgE,GAA9E,eAAuFP,KAAKY,KAElGd,EAAWa,cAAgBJ,GAC7BJ,EAAUU,SAAS,oBAGrB,IAAMC,EAAef,EAAO,uFAAD,OAAwFW,EAAxF,4BAAuHK,SAASZ,GACrJa,GAA6C,IAA9BlB,EAAWmB,eAA2B,EAAIH,EAAaI,KAAK,YAAYC,YAAW,GAAQ,GAEhHL,EAAaM,SAEbpB,KAAKH,UAAY,IAAIwB,UAAU,CAC7BC,OAAYtB,KACZG,UAAYD,EACZqB,MAAYrB,EAAWqB,QACvBC,OAAYxB,KAAKwB,OACjBZ,IAAYZ,KAAKY,IACjBa,MAAY,EACZC,IAAY1B,KAAK2B,eACjBC,UAAY,EACZC,OAAY,CACVC,EAAAA,QAAAA,OAAkB,CAChBpB,KAAgBA,EAChBqB,OAAgB,GAChBC,cAAgB,GAChBC,QAAgB,EAChBC,QAAgB,EAChBC,YAAgB,EAEhBC,MAAO,SAAUC,GACf,IAAMC,EAAStC,KAAKG,UAAUmB,SAASgB,SAASC,KAC1CC,EAASH,EAAEI,MAAQH,EACnBI,EAAS1C,KAAK2C,iBAAiBC,OAAO,CAAEJ,EAAGA,EAAGK,EAAG,EAAGC,EAAG,EAAGC,EAAG,IAAK,GAExE,GAAIL,EACF,GAAe,YAAXL,EAAEW,KACChD,KAAKiD,QAAQ3B,OAAOM,UACvB5B,KAAKiD,QAAQ3B,OAAO4B,OAAOR,EAAE9B,IAAK8B,EAAEjB,MAAOiB,EAAEhB,KAAK,QAE/C,GAAI1B,KAAKmD,eAAiBT,IAAM1C,KAAKiD,QAAQG,YAAa,CAG/D,GAFApD,KAAKG,UAAUkD,MAAM,QAEjBX,EAAEY,MAAO,CACX,IAAMf,EAAOD,EAASI,EAAEa,SAASvD,KAAKwD,OAAO/B,MAAQiB,EAAEa,SAASvD,KAAKwD,OAAOjC,MAAQ,EAEpFvB,KAAKG,UAAUsD,KAAK,QAASf,EAAEY,MAAM,IAAID,MAAM,CAAEK,QAAS,SAAUvD,UAAW,SAAUkD,MAAM,QAAQM,KAAK,SAASC,KAAKC,IAAI,QAAQ,WAAc,OAAOtB,EAAOxC,EAAOC,MAAMuB,QAAU,CAAI,GAC9L,CAEDvB,KAAKmD,aAAeT,CACrB,CAEJ,EAEDoB,qBAAsB,WACpB,IAAMC,EAAQ/D,KAEdA,KAAKgE,OAELhE,KAAKG,UAAU8D,GAAG,CAChBC,UAAY,SAAC7B,GAAQ0B,EAAM3B,MAAMC,EAAK,EACtC8B,SAAY,SAAC9B,GACX,GAAI0B,EAAMd,QAAQmB,UAAUC,GAAGhC,EAAEiC,gBAAkBP,EAAMd,QAAQmB,UAAUlD,KAAKmB,EAAEiC,eAAeC,OAC/F,OAAO,EAGTR,EAAM5D,UAAUkD,MAAM,QACtBU,EAAMZ,cAAe,CACtB,GACA,uBAGHnD,KAAKG,UAAU8D,GAAG,aAAc,qCAAqC,SAAC5B,GACpEA,EAAEmC,iBACH,GACF,EAEDC,aAAc,WACZzE,KAAKsD,MAAMO,IAAI,aAAf,UAAgC7D,KAAKsD,MAAMvB,SAA3C,MACD,KAIL+B,qBAAsB,WAAQ,EAE9BY,UAAW,WACT1E,KAAK2E,iBACL3E,KAAKoE,UAAUQ,QAChB,EAEDC,eAAgB,WACd7E,KAAK+D,MAAQ/D,KAAK6B,OAAO,EAC1B,EAEDiD,oBAAqB,WACnB,IAAMjF,EAAYG,KACZsB,EAAYtB,KAAKsB,OAEvB,SAAS8B,IACPvD,EAAUuD,aAAc,EACxBvD,EAAUkE,MAAMgB,KAAK,aAAa1B,MAAM,OACzC,CAED,SAAS2B,EAAe3C,EAAG4C,GACzBpF,EAAUuD,aAAc,EAExB,IAAMI,EAAQ3D,EAAU8B,eAAiB9B,EAAU0B,MAC7C2D,EAAmB,eAAX7C,EAAEW,KAAwBjD,EAAOC,MAAM2D,KAAK,gBAAgBuB,UAAOC,EAC3E1D,EAAiB,MAATyD,EAAe5D,EAAOG,MAAQ2D,KAAKC,IAAID,KAAKE,MAAML,EAAG1B,SAAShB,KAAOiB,GAAQ,GACrF9B,EAAiB,MAATwD,EAAe5D,EAAOI,IAAmB,aAAXW,EAAEW,KAAsBvB,EAAQH,EAAOiD,OAAS,EAAIa,KAAKE,MAAML,EAAGM,OAAOpE,YAAW,GAAQqC,GAAS/B,EAE7IA,IAAUH,EAAOG,OAASC,IAAQJ,EAAOI,KAC3CJ,EAAO4B,OAAOrD,EAAUe,IAAKa,EAAOC,GAAK,EAAiB,aAAXW,EAAEW,KAEpD,EAEiC,IAA9BlD,EAAWmB,gBACbjB,KAAKwF,eAAepE,SACpBpB,KAAKwF,eAAiBzF,IACtBI,EAAUU,SAAS,gBAEnBb,KAAKwF,eAAejE,MAAMP,GAG5BhB,KAAKoE,UAAYrE,EAAO,gGAAgGgB,SAASZ,GAAW0D,IAAI,CAC9ItB,KAAQvB,EACRO,MAAQvB,KAAKuB,MAAQP,IACpByE,WAAWxB,GAAG,CACfC,UAAY,SAAC7B,GAAQxC,EAAUkE,MAAM2B,WAAWtD,MAAMC,EAAK,EAC3D8B,SAAY,SAAC9B,GACX,IAAMsD,EAAK5F,EAAOsC,EAAEiC,eAEpB,GAAIzE,EAAUuE,UAAUC,GAAGsB,IAAO9F,EAAUuE,UAAUlD,KAAKyE,GAAIpB,QAAmC,QAAxBoB,EAAGZ,KAAK,aAAyBY,EAAGrE,SAAS+C,GAAGxE,EAAUkE,MAAMgB,KAAK,iBAAiB,IAC9J,OAAO,EAGTlF,EAAUkE,MAAMgB,KAAK,aAAa1B,MAAM,QACxCxD,EAAUkE,MAAMgB,KAAK,gBAAgB,EACtC,IAGEzD,EAAOM,UACV5B,KAAKoE,UAAUwB,UAAU,CACvBV,KAAc,IACdW,YAAc7F,KAAKM,QACnBmB,MAAc2B,EACd0C,KAAcd,IACbe,UAAU,CACXC,QAAc,OACdH,YAAc,SACdpE,MAAc2B,EACd0C,KAAcd,EACdiB,OAAc,SAAU5D,EAAG4C,GACzBA,EAAGiB,QAAQrC,IAAI,OAAQuB,KAAKC,IAAI,EAAGJ,EAAG1B,SAAShB,OAE3C0C,EAAG1B,SAAShB,KAAO,EACrB0C,EAAGiB,QAAQ3E,MAAM6D,KAAKe,IAAIlB,EAAGmB,KAAK7E,MAAO0D,EAAGiB,QAAQ5E,SAASC,QAAU0D,EAAG1B,SAAShB,OAEnF0C,EAAGiB,QAAQ3E,MAAM0D,EAAGmB,KAAK7E,MAAQ0D,EAAG1B,SAAShB,KAEhD,GAGN,EAEDoC,eAAgB,WACd,IAAMpC,EAASvC,KAAKsB,OAAOG,MAAQzB,KAAKwD,MAClCjC,EAASvB,KAAKsB,OAAOI,IAAQ1B,KAAKwD,MAASjB,EAEjDvC,KAAKoE,UAAUP,IAAI,CAAEtB,KAAMA,EAAMhB,MAAOA,GACzC,KAGqC,IAApCvB,KAAKqG,cAAcC,cACrBvG,EAAO,8BAA8BgC,QAAO,SAACwE,EAAGxD,GAAJ,OAAUA,EAAI5C,EAAU4B,QAAxB,IAAkCyE,UAAUxG,KAAKwF,eAEhG,CAED,SAASiB,IACP,IAAMtG,EAAYH,KAAKH,UAAUM,UAAUmB,SAE3CtB,KAAKH,UAAU6G,UACfvG,EAAUiB,SAEVnB,EAAgB0G,KAAK3G,KACtB,CAEDA,KAAKiE,GAAG,CACNS,UAAWzE,EAEX2G,cAAe,WACT5G,KAAKH,WACPG,KAAKH,UAAU8E,gBAElB,EAEDkC,cAAeJ,EAEfK,YAAa,SAAUlG,GACjBZ,KAAKH,WAAaG,KAAKH,UAAUe,MAAQA,GAC3C6F,EAAkBE,KAAK3G,KAE1B,GAEJ,E","sources":["webpack://genoverse/./src/js/plugins/karyotype.js"],"sourcesContent":["import '../../css/karyotype.css';\nimport Chromosome from '../Track/library/Chromosome';\n\nconst plugin = function (pluginConf) {\n  const jQuery = this.jQuery;\n\n  function createKaryotype() {\n    const chromosome   = jQuery('<div class=\"gv-chromosome\">');\n    const container    = jQuery('<div class=\"gv-karyotype-container\">').html(chromosome).insertBefore(this.wrapper);\n    const assemblyName = this.assembly || this.genomeName;\n    const name         = `${pluginConf.showAssembly && assemblyName ? `${assemblyName}: ` : ''}Chr ${this.chr}`;\n\n    if (pluginConf.showAssembly && assemblyName) {\n      container.addClass('gv-show-assembly');\n    }\n\n    const measureWidth = jQuery(`<div class=\"gv-chromosome\"><ul class=\"gv-label-container\"><li><span class=\"gv-name\">${name}</span></li></ul></div>`).appendTo(container);\n    const labelWidth   = pluginConf.karyotypeLabel === false ? 0 : measureWidth.find('.gv-name').outerWidth(true) + 10;\n\n    measureWidth.remove();\n\n    this.karyotype = new Genoverse({\n      parent    : this,\n      container : chromosome,\n      width     : chromosome.width(),\n      genome    : this.genome,\n      chr       : this.chr,\n      start     : 1,\n      end       : this.chromosomeSize,\n      isStatic  : true,\n      tracks    : [\n        Chromosome.extend({\n          name          : name,\n          height        : 20,\n          featureHeight : 20,\n          border        : false,\n          legend        : false,\n          unsortable    : true,\n\n          click: function (e) {\n            const offset = this.container.parent().offset().left;\n            const x      = e.pageX - offset;\n            const f      = this.featurePositions.search({ x: x, y: 1, w: 1, h: 1 })[0];\n\n            if (f) {\n              if (e.type === 'mouseup') {\n                if (!this.browser.parent.isStatic) {\n                  this.browser.parent.moveTo(f.chr, f.start, f.end, true);\n                }\n              } else if (this.hoverFeature !== f && !this.browser.hideTooltip) {\n                this.container.tipsy('hide');\n\n                if (f.label) {\n                  const left = offset + f.position[this.scale].start + f.position[this.scale].width / 2;\n\n                  this.container.attr('title', f.label[0]).tipsy({ trigger: 'manual', container: 'body' }).tipsy('show').data('tipsy').$tip.css('left', function () { return left - jQuery(this).width() / 2; });\n                }\n\n                this.hoverFeature = f;\n              }\n            }\n          },\n\n          addUserEventHandlers: function () {\n            const track = this;\n\n            this.base();\n\n            this.container.on({\n              mousemove : (e) => { track.click(e); },\n              mouseout  : (e) => {\n                if (track.browser.viewPoint.is(e.relatedTarget) || track.browser.viewPoint.find(e.relatedTarget).length) {\n                  return true;\n                }\n\n                track.container.tipsy('hide');\n                track.hoverFeature = false;\n              },\n            }, '.gv-image-container');\n\n            // Don't allow zooming in and out on the karyotype image\n            this.container.on('mousewheel', '.gv-image-container, .gv-selector', (e) => {\n              e.stopPropagation();\n            });\n          },\n\n          afterSetName: function () {\n            this.label.css('lineHeight', `${this.label.height()}px`);\n          },\n        }),\n      ],\n\n      addUserEventHandlers: () => {},\n\n      afterInit: function () {\n        this.updatePosition();\n        this.viewPoint.fadeIn();\n      },\n\n      afterAddTracks: function () {\n        this.track = this.tracks[0];\n      },\n\n      afterAddDomElements: function () {\n        const karyotype = this;\n        const parent    = this.parent;\n\n        function hideTooltip() {\n          karyotype.hideTooltip = true;\n          karyotype.track.prop('container').tipsy('hide');\n        }\n\n        function updateLocation(e, ui) {\n          karyotype.hideTooltip = false;\n\n          const scale = karyotype.chromosomeSize / karyotype.width;\n          const axis  = e.type === 'resizestop' ? jQuery(this).data('ui-resizable').axis : undefined;\n          const start = axis === 'e' ? parent.start : Math.max(Math.floor(ui.position.left * scale), 1);\n          const end   = axis === 'w' ? parent.end   : e.type === 'dragstop' ? start + parent.length - 1 : Math.floor(ui.helper.outerWidth(true) * scale) + start;\n\n          if (start !== parent.start || end !== parent.end) {\n            parent.moveTo(karyotype.chr, start, end, true, e.type === 'dragstop');\n          }\n        }\n\n        if (pluginConf.karyotypeLabel === false) {\n          this.labelContainer.remove();\n          this.labelContainer = jQuery();\n          container.addClass('gv-no-label');\n        } else {\n          this.labelContainer.width(labelWidth);\n        }\n\n        this.viewPoint = jQuery('<div class=\"gv-karyotype-viewpoint-wrapper\"><div class=\"gv-karyotype-viewpoint\"></div></div>').appendTo(container).css({\n          left  : labelWidth,\n          width : this.width - labelWidth,\n        }).children().on({\n          mousemove : (e) => { karyotype.track.controller.click(e); },\n          mouseout  : (e) => {\n            const el = jQuery(e.relatedTarget);\n\n            if (karyotype.viewPoint.is(el) || karyotype.viewPoint.find(el).length || (el.prop('nodeName') === 'IMG' && el.parent().is(karyotype.track.prop('imgContainers')[0]))) {\n              return true;\n            }\n\n            karyotype.track.prop('container').tipsy('hide');\n            karyotype.track.prop('hoverFeature', false);\n          },\n        });\n\n        if (!parent.isStatic) {\n          this.viewPoint.draggable({\n            axis        : 'x',\n            containment : this.wrapper,\n            start       : hideTooltip,\n            stop        : updateLocation,\n          }).resizable({\n            handles     : 'e, w',\n            containment : 'parent',\n            start       : hideTooltip,\n            stop        : updateLocation,\n            resize      : function (e, ui) {\n              ui.element.css('left', Math.max(0, ui.position.left));\n\n              if (ui.position.left > 0) {\n                ui.element.width(Math.min(ui.size.width, ui.element.parent().width() - ui.position.left));\n              } else {\n                ui.element.width(ui.size.width + ui.position.left);\n              }\n            },\n          });\n        }\n      },\n\n      updatePosition: function () {\n        const left  =  this.parent.start * this.scale;\n        const width = (this.parent.end   * this.scale) - left;\n\n        this.viewPoint.css({ left: left, width: width });\n      },\n    });\n\n    if (this.loadedPlugins.controlPanel !== true) {\n      jQuery('<li class=\"gv-unsortable\">').height((i, h) => h + container.height()).prependTo(this.labelContainer);\n    }\n  }\n\n  function recreateKaryotype() {\n    const container = this.karyotype.container.parent();\n\n    this.karyotype.destroy();\n    container.remove();\n\n    createKaryotype.call(this);\n  }\n\n  this.on({\n    afterInit: createKaryotype,\n\n    afterSetRange: function () {\n      if (this.karyotype) {\n        this.karyotype.updatePosition();\n      }\n    },\n\n    afterSetWidth: recreateKaryotype,\n\n    afterMoveTo: function (chr) {\n      if (this.karyotype && this.karyotype.chr !== chr) {\n        recreateKaryotype.call(this);\n      }\n    },\n  });\n};\n\nexport default { karyotype: plugin };\n"],"names":["karyotype","pluginConf","jQuery","this","createKaryotype","chromosome","container","html","insertBefore","wrapper","assemblyName","assembly","genomeName","name","showAssembly","chr","addClass","measureWidth","appendTo","labelWidth","karyotypeLabel","find","outerWidth","remove","Genoverse","parent","width","genome","start","end","chromosomeSize","isStatic","tracks","Chromosome","height","featureHeight","border","legend","unsortable","click","e","offset","left","x","pageX","f","featurePositions","search","y","w","h","type","browser","moveTo","hoverFeature","hideTooltip","tipsy","label","position","scale","attr","trigger","data","$tip","css","addUserEventHandlers","track","base","on","mousemove","mouseout","viewPoint","is","relatedTarget","length","stopPropagation","afterSetName","afterInit","updatePosition","fadeIn","afterAddTracks","afterAddDomElements","prop","updateLocation","ui","axis","undefined","Math","max","floor","helper","labelContainer","children","controller","el","draggable","containment","stop","resizable","handles","resize","element","min","size","loadedPlugins","controlPanel","i","prependTo","recreateKaryotype","destroy","call","afterSetRange","afterSetWidth","afterMoveTo"],"sourceRoot":""}