<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="The European Bioinformatics Institute" />
    <meta name="author" content="EBI Web Team" />
    <meta http-equiv="Content-Language" content="en-GB" />

    <meta http-equiv="Window-target" content="_top" />
    <meta name="no-email-collection" content="http://www.unspam.com/noemailcollection/" />
    <title>R-Cloud Workbench</title>

    <link rel="stylesheet"  href="http://www.ebi.ac.uk/inc/css/contents.css"     type="text/css" />
    <link rel="stylesheet"  href="http://www.ebi.ac.uk/inc/css/userstyles.css"   type="text/css" />
    <script  src="http://www.ebi.ac.uk/inc/js/contents.js" type="text/javascript"></script>
    <link rel="SHORTCUT ICON" href="http://www.ebi.ac.uk/bookmark.ico" />

<!--  start meta tags, css , javascript here   -->
    <link rel="stylesheet"  href="http://www.ebi.ac.uk/inc/css/sidebars.css"   type="text/css" />

    <link rel="stylesheet" type="text/css" href="/css/genoverse.css" />
    <link rel="stylesheet" type="text/css" href="/css/controlPanel.css" />
    <link rel="stylesheet" type="text/css" href="/css/labelControls.css" />
    <link rel="stylesheet" type="text/css" href="/css/resizer.css" />
    <!--link rel="stylesheet" type="text/css" href="css/hoverLabels.css" /-->

    <script type="text/javascript" src="/js/lib/jquery.js"></script>
    <script type="text/javascript" src="/js/lib/jquery-ui.js"></script>
    <script type="text/javascript" src="/js/lib/lazyload.js"></script>
    <script type="text/javascript" src="/js/lib/jquery.mousewheel.js"></script>
    <script type="text/javascript" src="/js/lib/jquery.mousehold.js"></script>

    <script type="text/javascript" src="/js/lib/Base.js"></script>
    <script type="text/javascript" src="/js/lib/rtree.js"></script>
    <script type="text/javascript" src="/js/lib/FRegion.js"></script>
    <script type="text/javascript" src="/js/lib/url.js"></script>

    <script type="text/javascript" src="/js/Genoverse.js"></script>
    <script type="text/javascript" src="/js/Track.js"></script>

    <script type="text/javascript" src="/js/Track/Scalebar.js"></script>
    <script type="text/javascript" src="/js/Track/Sequence.js"></script>
    <script type="text/javascript" src="/js/Track/DAS/Sequence.js"></script>

    <script type="text/javascript" src="/js/Track/DAS.js"></script>
    <script type="text/javascript" src="/js/Track/DAS/colorMap.js"></script>
    <script type="text/javascript" src="/js/Track/DAS/Transcript.js"></script>

    <script type="text/javascript" src="/js/Track/SV.js"></script>

    <script type="text/javascript" src="/js/plugins/controlPanel.js"></script>
    <script type="text/javascript" src="/js/plugins/trackControls.js"></script>
    <script type="text/javascript" src="/js/plugins/resizer.js"></script>


    <style type="text/css">
        @media print {
        body, .contents, .header, .contentsarea, .head {
        position: relative;
        }
        }
    </style>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-36446418-1']);
      _gaq.push(['_setDomainName', 'ebi.ac.uk']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript">

        var makeGeuvadisTrack = function(trackName, url, color){
            track = {
                name          : trackName,
                url           : url,
                height        : 100,
                featureHeight : 98,
                labels        : 'overlay',
                resizable     : false,
                info          : 'Geuvadis data',
                dataType      : 'text',
                featureColor  : color,

                makeFeature: function (line) {
                    //alert("Geuvadis makeFeature " + line);

                    var values = line.split(' ');
                    var feature = {
                        id      : values[0] + "_" + values[1] + "_" + values[2] + "_" + values[3],
                        chr     : values[0],
                        start   : parseInt(values[1], 10), // * 1,
                        end     : parseInt(values[2], 10), // * 1,
                        score   : values[3],
                        logx10  : Math.log(parseFloat(values[3]) + 1) * 10,
                        color   : this.featureColor
                    };

                    return(feature);
                },

                parseData: function (data) {
                    var lines = data.split("\r\n");
                    for (var i=0; i<lines.length-2; i+=3) {
                        //alert("Geuvadis parseData lines.length=" + lines.length);

                        var feature1 = this.makeFeature(lines[i]);   // min
                        var feature2 = this.makeFeature(lines[i+1]); // avg
                        var feature3 = this.makeFeature(lines[i+2]); // max

                        var min = feature1.score;
                        var avg = feature2.score;
                        var max = feature3.score;

                        feature1.max = max;
                        feature1.avg = avg;
                        feature1.min = min;

                        feature2.max = max;
                        feature2.avg = avg;
                        feature2.min = min;

                        feature3.max = max;
                        feature3.avg = avg;
                        feature3.min = min;

                        this.insertFeature(feature1);
                        this.insertFeature(feature2);
                        this.insertFeature(feature3);
                    }
                },

                draw: function (features, context, scale) {
                    //alert("Geuvadis draw features.length=" + features.length);

                    for (var i=0; i<features.length; i++) {
                        var feature = features[i];
                        context.fillStyle = feature.color; //'black'

                        context.fillRect(Math.round(feature.position[scale].X),
                                this.featureHeight - Math.round(feature.position[scale].Y),
                                feature.position[scale].width, -Math.round(feature.logx10));
                    }
                }
            };

            return(track);
        }

        // Genoverse configuration
        var genoverseConfig = {
            container      : '#genoverse',    // jQuery style selector
            width          : 740,
            chromosomeSize : 249250621,                         // chromosome 1, human
            chr            : getURLParameter("chr", 1),         // 1,
            start          : getURLParameter("start", 870000),  // 870000,
            end            : getURLParameter("end", 920000),    // 920000,
            dragAction     : 'scroll',
            wheelAction    : 'off',

            setChrAndRange: function (chr, start, end, update, force) {
                // TODO:
                // get proper browser boundaries
                // get chromosome length

                this.chr = chr;

                this.setRange(start, end, update, force);
            },

            controls : Genoverse.controls.concat([
              {
                icon   : 'share',
                name   : 'Share this view',
                action : function () {
                  var browser = this;
                  $(".genoverse_panel button.share").click(function(){
                    var link = window.location.href.split('?')[0] + browser.getQueryString();

                    var shareMenu = {
                        title  : 'Link:',
                        ' ' : "<a style='color: #FFFFFF' href="+link+">" + link + "</a>"
                    };

                    var menu = browser.makeMenu(shareMenu);
                    menu.addClass('track_info');
                  });
                }
              }
            ]),

            tracks: [
                {
                    type : 'Scalebar'
                },

                //{
                //  name      : 'Sequence',
                //  threshold : 5000,
                //  type      : 'DAS.Sequence',
                //  height    : 60,
                //},

                {
                    type : 'DAS.Transcript'
                },

                makeGeuvadisTrack("Geuvadis <br /> TSI <br /> Summary",
                                  "http://wwwdev.ebi.ac.uk/Tools/geuvadis-das/tsi?r=__CHR__:__START__-__END__",
                                  "rgba(155,48,255,0.5)"),

                makeGeuvadisTrack("Geuvadis <br /> YRI <br /> Summary",
                                  "http://wwwdev.ebi.ac.uk/Tools/geuvadis-das/yri?r=__CHR__:__START__-__END__",
                                  "rgba(255,165,0,0.5)"),

                makeGeuvadisTrack("Geuvadis <br /> GBR <br /> Summary",
                                  "http://wwwdev.ebi.ac.uk/Tools/geuvadis-das/gbr?r=__CHR__:__START__-__END__",
                                  "rgba(105,139,34,0.5)"),

                makeGeuvadisTrack("Geuvadis <br /> CEU <br /> Summary",
                                  "http://wwwdev.ebi.ac.uk/Tools/geuvadis-das/ceu?r=__CHR__:__START__-__END__",
                                  "rgba(176,23,31,0.5)"),

                makeGeuvadisTrack("Geuvadis <br /> FIN <br /> Summary",
                                  "http://wwwdev.ebi.ac.uk/Tools/geuvadis-das/fin?r=__CHR__:__START__-__END__",
                                  "rgba(67,110,238,0.5)"),

                makeGeuvadisTrack("Geuvadis <br /> Normalized <br /> Summary",
                                  "http://wwwdev.ebi.ac.uk/Tools/geuvadis-das/normalized?r=__CHR__:__START__-__END__",
                                  "rgba(250,0,0,0.5)"),

                makeGeuvadisTrack("Geuvadis <br /> Server <br /> Original",
                                  "http://wwwdev.ebi.ac.uk/Tools/geuvadis-das/range?r=__CHR__:__START__-__END__",
                                  "rgba(100,0,0,0.5)")


                /*
                {
                    name : 'Geuvadis',
                    url  : 'http://wwwdev.ebi.ac.uk/Tools/geuvadis-das/range?r=__CHR__:__START__-__END__',
                    height : 300,
                    dataType : 'text',

                    parseData : function (data) {
                        var array = data.split('\r\n');
                        for(var i = 0;i<array.length;i++) {
                            var parts = array[i].split(" ");

                            //alert("adding feature parts.length=" + parts.length);

                            if (parts.length === 5) {
                                var feature = {
                                    id :    parts[0] + "_" + parts[1] + "_" + parts[2] + "_" + parts[3],
                                    start:  parseInt(parts[1], 10),
                                    end:    parseInt(parts[2], 10),
                                    seg:    parts[0],
                                    score:  Math.log(parseFloat(parts[3]) + 1) * 5,
                                    color:  'rgba(' + parts[4] + ',0.5)'
                                };

                                this.insertFeature(feature);
                                //alert("adding feature " + feature.id + " start=" + feature.start + " end=" + feature.end + " score=" + feature.score);
                            }
                        }

                        var lines = data.split("\r\n");
                        for (var i=0; i<lines.length-2; i+=3) {

                            var values = lines[i].split(' ');
                            var feature = {
                                id : values[0],
                                seg : values[0],
                              start : values[1]*1,
                              end   : values[2]*1,
                              y     : Math.log(values[3]<0.00001 ? 0.00001 : values[3]),
                              color : 'rgba(250,0,0,0.5)'
                            };
                            this.insertFeature(feature);

                            values = lines[i+1].split(' ');
                            feature = {
                                start : values[1]*1,
                                end   : values[2]*1,
                                y     : Math.log(values[3]<0.00001 ? 0.00001 : values[3]),
                                color : 'rgba(0,250,0,0.5)'
                            };
                            this.insertFeature(feature);

                            values = lines[i+2].split(' ');
                            feature = {
                                start : values[1]*1,
                                end   : values[2]*1,
                                y     : Math.log(values[3]<0.00001 ? 0.00001 : values[3]),
                                color : 'rgba(0,0,250,0.5)'
                            };
                            this.insertFeature(feature);
                        }
                    },
                    drawFeature: function (feature, context, scale) {
                        context.fillStyle = feature.color;
                        context.fillRect(feature.x, this.height-10 , feature.width,  -5*(feature.y+10));
                    }
            },
            */

                    /*

            {
                name          : "Geuvadis <br /> Server <br /> Original",
                url           : "http://wwwdev.ebi.ac.uk/Tools/geuvadis-das/range?r=__CHR__:__START__-__END__",
                height        : 100,
                featureHeight : 98,
                labels        : 'overlay',
                resizable     : false,
                //autoHeight    : true,
                info          : 'Geuvadis normalized summary',
                dataType      : 'text',

                parseData: function (data) {
                    //alert("Geuvadis adding features" + data);
                    var array = data.split('\r\n');
                    for(var i = 0;i<array.length;i++) {
                        var parts = array[i].split(" ");

                        //alert("adding feature parts.length=" + parts.length);

                        if (parts.length === 5) {
                            var feature = {
                                id :    parts[0] + "_" + parts[1] + "_" + parts[2] + "_" + parts[3],
                                start:  parseInt(parts[1], 10),
                                end:    parseInt(parts[2], 10),
                                seg:    parts[0],
                                score:  Math.log(parseFloat(parts[3]) + 1) * 10,
                                color:  'rgba(' + parts[4] + ',0.5)'
                            };

                            this.insertFeature(feature);
                            //alert("adding feature " + feature.id + " start=" + feature.start + " end=" + feature.end + " score=" + feature.score);
                        }
                    }
                },

                draw: function (features, context, scale) {
                    //alert("Geuvadis draw features.length=" + features.length);

                    //var color = this.color;
                    //context.fillStyle = color;
                    //alert("Geuvadis draw features.length=" + features.length);

                    for (var i=0; i<features.length; i++) {
                        var feature = features[i];
                        context.fillStyle = feature.color; //'black'

                        //alert("Geuvadis draw fillRect X=" + Math.round(feature.position[scale].X) + " Y="+Math.round(feature.position[scale].Y) + " w="+feature.position[scale].width+" h="+feature.position[scale].height + " score="+feature.score + " t.h=" + this.height);
                        //context.fillRect(Math.round(feature.position[scale].X), feature.position[scale].height - Math.round(feature.position[scale].Y), feature.position[scale].width, -Math.round(feature.score));
                        context.fillRect(Math.round(feature.position[scale].X),
                                this.featureHeight - Math.round(feature.position[scale].Y),
                                feature.position[scale].width, -Math.round(feature.score));

                        /*
                            if (feature.color && feature.color != color) {
                            color = feature.color;
                            context.fillStyle = color;
                            }
                        */

                          /*
                        if (this.labels) {
                          if (feature.labelColor && feature.labelColor != color) {
                            color = feature.labelColor
                            context.fillStyle = color;
                        }
                        if (this.labels === 'overlay') {
                            if (context.measureText(feature.label).width < feature.position[scale].width)
                                context.fillText(feature.label, Math.max(feature.position[scale].X + 1, 1), feature.position[scale].Y);
                            } else {
                              context.fillText(feature.label, feature.position[scale].X, feature.position[scale].Y + this.featureHeight + this.featureSpacing);
                            }
                          }
                      */

            /*
                    }
*/
                  /*
                      var i = features.length;
                      context.textBaseline = 'top';
                      while (i--) {
                          var feature = features[i];
                          context.fillRect(Math.round(feature.position[scale].X), 0, Math.ceil(feature.position[scale].width), this.featureHeight/2);
                          if (feature.major) {
                              context.fillRect(Math.round(feature.position[scale].X), 0, 1, this.featureHeight);
                              context.fillText(feature.label, feature.position[scale].X, this.featureHeight);
                          }
                      }
                      context.fillRect(0, 0, context.canvas.width, 1);
                      context.fillRect(0, this.featureHeight/2, context.canvas.width, 1);
                  */
        /*
        }
            }
*/

        ]
      };

      $(document).ready(function(){ new Genoverse(genoverseConfig) });

    </script>

</head>



<body onLoad="if(navigator.userAgent.indexOf('MSIE') != -1) {document.getElementById('head').allowTransparency = true;}; fixBody(); ">
<div class="headerdiv" id="headerdiv" style="position:absolute; z-index: 1;">
  <iframe src="http://www.ebi.ac.uk/inc/head.html" name="head" id="head" frameborder="0" marginwidth="0px" marginheight="0px" scrolling="no"  width="100%" style="position:absolute; z-index: 1; height: 57px;"></iframe>
</div>
<div class="contents" id="contents" style="width:800px">
    <table class="contentspane" id="contentspane" summary="The main content pane of the page">
        <tr>
            <td class="contentsarea" id="contentsarea" style="position:absolute">

                <h1>Geuvadis Data Browser</h1>

                The Geuvadis project aims to bring together the knowledge and resources on medical genome sequencing at a European
                level and allow researchers to develop and test new hypotheses on the genetic basis of disease; to develop standards
                in sequencing data processing, storage, submission etc. The analysis of samples from the medical field, using
                RNA and DNA sequencing will allow the project to set up standards in operating procedures and biological/medical
                interpretation of sequence data in relation to clinical phenotypes.<br>

                <br>

                <div id="genoverse"></div>

                <h2>Subscribe</h2>

              <span style="position:fixed;bottom:30px;right:0px;padding-right:10px">Geuvadis Data Server</span>
            </td>
        </tr>
    </table>

    <table class="footerpane" id="footerpane" summary="The main footer pane of the page" style="position:fixed; bottom: 0px">
        <tr>
            <td colspan ="4" class="footerrow">
                <div class="footerdiv" id="footerdiv"  style="z-index:2;">
	                <iframe src="http://www.ebi.ac.uk/inc/foot.html" name="foot" frameborder="0" marginwidth="0px" marginheight="0px" scrolling="no"  height="22px" width="100%"  style="z-index:2;"></iframe>
                </div>
            </td>
        </tr>
    </table>
  <script  src="http://www.ebi.ac.uk/inc/js/footer.js" type="text/javascript"></script>
</div>

</body>
</html>